## 一般原则

### 明确表达您的指令

AI 模型对清晰、明确的指令反应良好。具体说明您期望的输出可以帮助提高结果质量。

1. 示例：创建分析仪表板

  **效果较差：**

  ```text
  创建一个分析仪表板
  ```

  **效果更好：**

  ```text
  创建一个分析仪表板。包含尽可能多的相关功能和交互。超越基础功能，创建一个功能齐全的实现方案。
  ```

### 添加上下文以提高性能

提供指令背后的上下文或动机，例如向 AI 解释为什么这种行为很重要，可以帮助 AI 更好地理解您的目标并提供更有针对性的回答。

1. 示例：格式偏好
  **效果较差：**

  ```text
  绝不使用省略号
  ```

  **效果更好：**

  ```text
  您的回答将由文本转语音引擎朗读，所以请不要使用省略号，因为文本转语音引擎不知道如何发音。
  ```

AI 足够聪明，能够从解释中进行泛化。

### 注意示例和细节

AI 模型在遵循指令时会注意细节和示例。确保您的示例与您想要鼓励的行为一致，并最小化您想要避免的行为。

## 特定情况的指导

### 控制回答的格式

我们发现以下几种方法在引导 AI 模型的输出格式方面特别有效：

1. **告诉 AI 应该做什么，而不是不应该做什么**

   * 不要用："不要在回答中使用markdown"
   * 尝试用："您的回答应该由流畅连贯的散文段落组成。"

2. **使用XML格式指示符**

   * 尝试："在`<smoothly_flowing_prose_paragraphs>`标签中编写回答的散文部分。"

3. **使您的提示风格与期望的输出相匹配**

   您在提示中使用的格式风格可能会影响 AI 的回答风格。如果您仍然遇到输出格式的可控性问题，我们建议尽可能使您的提示风格与您期望的输出风格相匹配。例如，从提示中删除markdown可以减少输出中markdown的数量。

### 利用思考和交错思考能力

AI 提供思考能力，这对于涉及工具使用后反思或复杂多步推理的任务特别有帮助。您可以引导其初始或交错思考，以获得更好的结果。

```text 示例提示
在收到工具结果后，仔细反思其质量并确定最佳下一步行动，然后再继续。使用您的思考来基于这些新信息进行规划和迭代，然后采取最佳的下一步行动。
```

### 优化并行工具调用

AI 模型在并行工具执行方面表现出色。即使没有任何提示，它们在使用并行工具调用方面也有很高的成功率，但一些小的提示可以将这种行为的成功率提高到约100%。我们发现以下提示最有效：

```text 代理的示例提示
为了最大效率，当您需要执行多个独立操作时，同时调用所有相关工具，而不是按顺序调用。
```

### 减少代理编码中的文件创建

AI 模型有时可能会创建新文件用于测试和迭代，特别是在处理代码时。这种方法允许 AI 使用文件，尤其是Python脚本，作为"临时草稿"，然后再保存最终输出。使用临时文件可以改善代理编码用例的结果。

如果您希望最小化新文件的创建，可以指示 AI 在完成后进行清理：

```text 示例提示
如果您创建了任何临时新文件、脚本或用于迭代的辅助文件，请在任务结束时通过删除这些文件来进行清理。
```

### 增强视觉和前端代码生成

对于前端代码生成，您可以通过提供明确的鼓励来引导 AI 模型创建复杂、详细和交互式的设计：

```text 示例提示
不要有所保留。全力以赴。
```

您还可以通过提供额外的修饰语和关注点的详细信息来提高 AI 在特定领域的前端性能：

* "包含尽可能多的相关功能和交互"
* "添加周到的细节，如悬停状态、过渡和微交互"
* "创建一个展示网页开发能力的令人印象深刻的演示"
* "应用设计原则：层次结构、对比、平衡和动态"

---

# 使用提示模板和变量

在使用 AI 部署基于 LLM 的应用程序时，您的 API 调用通常包含两种类型的内容：

* **固定内容：** 在多次交互中保持不变的静态指令或上下文
* **变量内容：** 随每个请求或对话而变化的动态元素，例如：
  * 用户输入
  * 用于检索增强生成（RAG）的检索内容
  * 对话上下文，如用户账户历史
  * 系统生成的数据，如来自其他独立 AI 调用的工具使用结果

# 提示模板示例

让我们考虑一个将英文文本翻译成西班牙文的简单应用程序。由于您预期这个文本会在用户之间或调用 AI 时发生变化，因此翻译的文本是变量。这个翻译文本可以从数据库或用户输入中动态检索。

因此，对于您的翻译应用程序，您可以使用这个简单的提示模板：

```
Translate this text from English to Spanish: {{text}}
```

---

# 保持清晰、直接和详细

在与 AI 交互时，可以将其视为一位聪明但非常新的员工（有健忘症），需要明确的指示。像任何新员工一样，AI 并不了解你的规范、风格、准则或首选的工作方式。
你越是精确地解释你想要什么，AI 的回应就会越好。

## 如何保持清晰、具有上下文和具体

* **为 AI 提供上下文信息：** 就像你在了解更多上下文的情况下可能会更好地完成任务一样，AI 在有更多上下文信息的情况下也会表现得更好。上下文信息的一些例子：
  * 任务结果将用于什么
  * 输出内容面向什么受众
  * 任务属于什么工作流程，以及这个任务在工作流程中的位置
  * 任务的最终目标，或者成功完成任务是什么样子
* **具体说明你希望 AI 做什么：** 例如，如果你只想要 AI 输出代码而不要其他内容，就要明确说明。
* **按顺序提供指示：** 使用编号列表或项目符号，以更好地确保 AI 按照你想要的方式执行任务。

---

# 使用示例（多示例提示）来引导 AI 的行为

示例是让 AI 精确生成你所需内容的秘密武器捷径。通过在提示中提供一些精心设计的示例，你可以显著提高 AI 输出的准确性、一致性和质量。
这种技术被称为少样本或多示例提示，对于需要结构化输出或遵循特定格式的任务特别有效。

**增强你的提示**: 包含 3-5 个多样化、相关的示例来向 AI 准确展示你想要的内容。示例越多 = 表现越好，尤其是对于复杂任务。

## 为什么要使用示例？

* **准确性**：示例减少对指令的误解。
* **一致性**：示例强制执行统一的结构和风格。
* **性能**：精心选择的示例可以提升 AI 处理复杂任务的能力。

## 制作有效的示例

为了获得最大效果，请确保你的示例是：

* **相关的**：你的示例反映了你的实际用例。
* **多样化的**：你的示例涵盖边缘情况和潜在挑战，并且有足够的变化使 AI 不会无意中捕捉到不必要的模式。
* **清晰的**：你的示例用 `<example>` 标签包装（如果有多个，则嵌套在 `<examples>` 标签中）以保持结构。

---

# 让 AI 思考（思维链提示）以提高性能

在面对研究、分析或问题解决等复杂任务时，给 AI 思考的空间可以显著提高其表现。这种被称为思维链（CoT）提示的技术，鼓励 AI 逐步分解问题，从而产生更准确和细致的输出。

## 实施思维链之前

### 为什么要让 AI 思考？

* **准确性：** 逐步解决问题可以减少错误，尤其是在数学、逻辑、分析或一般复杂任务中。
* **连贯性：** 结构化思维可以产生更连贯、组织更完善的回答。
* **调试：** 查看 AI 的思维过程有助于你找出提示可能不清晰的地方。

### 为什么不让 AI 思考？

* 增加输出长度可能影响延迟。
* 并非所有任务都需要深入思考。明智地使用思维链以确保性能和延迟的适当平衡。

对于人类需要思考的任务，如复杂数学、多步骤分析、编写复杂文档或涉及多个因素的决策，请使用思维链。

## 如何提示思考

下面的思维链技术按**从简单到复杂的顺序**排列。较简单的方法在上下文窗口中占用较少空间，但通常功能也较弱。

**思维链提示：** 始终让 AI 输出其思考过程。如果不输出思维过程，就不会发生思考！

* **基本提示：** 在提示中包含"逐步思考"。
  * 缺乏关于*如何*思考的指导（如果任务特别针对你的应用、用例或组织，这尤其不理想）
* **引导式提示：** 概述 AI 在思考过程中要遵循的具体步骤。
* **结构化提示：** 使用像 `<thinking>` 和 `<answer>` 这样的 XML 标签来分离推理和最终答案。

---

# 使用XML标签构建你的提示词

当你的提示词包含多个组件(如上下文、指令和示例)时，XML标签可以成为改变游戏规则的工具。它们可以帮助 AI 更准确地解析你的提示词，从而产生更高质量的输出。

**XML提示**: 使用像`<instructions>`、`<example>`和`<formatting>`这样的标签来清晰地分隔提示词的不同部分。这可以防止 AI 混淆指令与示例或上下文。

## 为什么要使用XML标签？

* **清晰度：** 清晰地分隔提示词的不同部分，确保提示词结构良好。
* **准确性：** 减少因 AI 误解提示词部分而导致的错误。
* **灵活性：** 无需重写所有内容即可轻松查找、添加、删除或修改提示词的部分内容。
* **可解析性：** 让 AI 在输出中使用XML标签，可以通过后处理更容易提取其响应的特定部分。

AI 并没有经过特定的"最佳"XML标签训练，尽管我们建议你的标签名称要与它们所包含的信息相符。

## 标签使用最佳实践

1. **保持一致性**: 在整个提示词中使用相同的标签名称，并在谈论内容时引用这些标签名称（例如，`使用<contract>标签中的合同...`）。
2. **嵌套标签**: 对于层次结构内容，你应该嵌套标签`<outer><inner></inner></outer>`。

**高级用户提示**: 将XML标签与其他技术结合使用，如多示例提示（`<examples>`）或思维链（`<thinking>`、`<answer>`）。这将创建超结构化、高性能的提示词。

---

# 通过系统提示给 AI 赋予角色

在使用 AI 时，您可以通过使用`system`参数来赋予它一个角色，从而显著提升其表现。这种被称为角色提示的技术，是使用系统提示与 AI 交互的最强大方式。

合适的角色可以将 AI 从一个通用助手转变为您的虚拟领域专家！

**系统提示技巧**：使用`system`参数来设置 AI 的角色。将其他所有内容（如特定任务的指令）放在`user`轮次中。

## 为什么要使用角色提示？

* **提高准确性：**在复杂场景中（如法律分析或财务建模），角色提示可以显著提升 AI 的表现。
* **定制语气：**无论您需要CFO的简洁还是文案撰写人的文采，角色提示都可以调整 AI 的沟通风格。
* **提升专注度：**通过设置角色背景，AI 能更好地保持在您任务特定要求的范围内。

***

## 如何给 AI 赋予角色

在 OpenAI API 中使用`system`参数来设置 AI 的角色：

```python
import openai

client = openai.OpenAI()

response = client.chat.completions.create(
    model="xxx",
    messages=[
        {"role": "system", "content": "You are a seasoned data scientist at a Fortune 500 company."}, # <-- 角色提示
        {"role": "user", "content": "Analyze this dataset for anomalies: <dataset>{{DATASET}}</dataset>"}
    ]
)
```

**角色提示技巧**：尝试不同的角色！对于相同的数据，`数据科学家`可能会看到与`营销策略师`不同的见解。而`专门为世界500强公司进行客户洞察分析的数据科学家`可能会产生又一种不同的结果！

---

# 预填充 AI 的回复以获得更好的输出控制(又称前缀续写、预测输出（Predicted Outputs）)


如果你想让模型输出思维链，就不要用前缀续写。

在使用 AI 时，您有独特的能力通过预填充 `assistant` 消息来引导其回复。这种强大的技术允许您指导 AI 的行动，跳过前言，强制使用特定格式如 JSON 或 XML，甚至帮助 AI 在角色扮演场景中保持角色一致性。

在某些 AI 表现不如预期的情况下，几句预填充的句子可以极大地改善 AI 的表现。一点预填充就能产生很大的效果！

## 如何预填充 AI 的回复

要进行预填充，请在 `assistant` 消息中包含所需的初始文本（AI 的回复将从 `assistant` 消息结束的地方继续）：

```python
from openai import OpenAI

client = OpenAI(
    api_key="<your api key>",
    base_url="https://api.deepseek.com/beta",
)

messages = [
    {"role": "user", "content": "Please write quick sort code"},
    {"role": "assistant", "content": "```python\n", "prefix": True}
]
response = client.chat.completions.create(
    model="deepseek-chat",
    messages=messages,
    stop=["```"],
)
print(response.choices[0].message.content)
```

---

# 链式复杂提示以获得更强的性能

在处理复杂任务时，如果你试图在单个提示中处理所有内容，AI 有时可能会出错。思维链(CoT)提示很好，但如果你的任务有多个不同的步骤，每个步骤都需要深入思考怎么办？

这就需要提示链：将复杂任务分解成更小、可管理的子任务。

## 为什么要链式提示？

1. **准确性**：每个子任务都能得到 AI 的充分关注，减少错误。
2. **清晰度**：更简单的子任务意味着更清晰的指令和输出。
3. **可追溯性**：轻松定位和修复提示链中的问题。

## 何时使用链式提示

对于多步骤任务如研究综合、文档分析或迭代内容创作，使用链式提示。当任务涉及多个转换、引用或指令时，链式提示可以防止 AI 遗漏或处理错误步骤。

**记住**： 链条中的每个环节都能得到 AI 的充分关注！
**调试提示**：如果 AI 遗漏了某个步骤或表现不佳，将该步骤单独放在一个提示中。这样你可以微调有问题的步骤，而无需重做整个任务。

## 如何链式提示

1. **识别子任务**：将任务分解为不同的、连续的步骤。
2. **使用XML构建清晰的交接**：使用XML标签在提示之间传递输出。
3. **设定单一任务目标**：每个子任务应该有一个明确的单一目标。
4. **迭代**：根据 AI 的表现改进子任务。

### 链式工作流示例：

* **多步骤分析**
* **内容创作流程**：研究 → 大纲 → 草稿 → 编辑 → 格式化。
* **数据处理**：提取 → 转换 → 分析 → 可视化。
* **决策制定**：收集信息 → 列出选项 → 分析每个选项 → 推荐。
* **验证循环**：生成内容 → 审查 → 改进 → 重新审查。

**优化提示**：对于具有独立子任务的任务（如分析多个文档），创建单独的提示并并行运行以提高速度。

### 高级：自我纠正链

你可以链式提示让 AI 审查自己的工作！这可以捕获错误并改进输出，特别是对于高风险任务。

---

# 长文本提示技巧

AI 的长上下文窗口使其能够处理复杂的、数据丰富的任务。本指南将帮助您有效地利用这一能力。

## 长文本提示的基本技巧

* **将长文本数据放在顶部**：将您的长文档和输入（约20K+ tokens）放在提示的顶部，位于查询、指令和示例之上。这可以显著提高 AI 在所有模型中的表现。

测试表明，将查询放在末尾可以将响应质量提高多达30%，特别是在处理复杂的多文档输入时。

* **使用XML标签构建文档内容和元数据**：在使用多个文档时，用`<document>`标签包装每个文档，并使用`<document_content>`和`<source>`（以及其他元数据）子标签以提高清晰度。

1. 多文档结构示例
    ```xml
    <documents>
      <document index="1">
        <source>annual_report_2023.pdf</source>
        <document_content>
          {{ANNUAL_REPORT}}
        </document_content>
      </document>
      <document index="2">
        <source>competitor_analysis_q2.xlsx</source>
        <document_content>
          {{COMPETITOR_ANALYSIS}}
        </document_content>
      </document>
    </documents>

    分析年度报告和竞争对手分析。识别战略优势并推荐第三季度重点关注领域。
    ```

* **用引用支持响应**：对于长文档任务，请先让 AI 引用文档中的相关部分，然后再执行任务。这有助于 AI 从文档内容的"噪音"中筛选出重要信息。

1. 引用提取示例
    ```xml
    您是一位AI医生助手。您的任务是帮助医生诊断可能的患者疾病。

    <documents>
      <document index="1">
        <source>patient_symptoms.txt</source>
        <document_content>
          {{PATIENT_SYMPTOMS}}
        </document_content>
      </document>
      <document index="2">
        <source>patient_records.txt</source>
        <document_content>
          {{PATIENT_RECORDS}}
        </document_content>
      </document>
      <document index="3">
        <source>patient01_appt_history.txt</source>
        <document_content>
          {{PATIENT01_APPOINTMENT_HISTORY}}
        </document_content>
      </document>
    </documents>

    从患者记录和就诊历史中找出与诊断患者报告症状相关的引用。将这些引用放在<quotes>标签中。然后，根据这些引用，列出所有能帮助医生诊断患者症状的信息。将您的诊断信息放在<info>标签中。
    ```

---

# 最终杀手锏：拍照学习（OpenAI的说法）

解释：通过人工 干预/编辑/编写 上下文中的 user 和 assistant 消息，给模型一个例子，让模型在完全不熟悉的领域提供更好的结果。

比如：

**system**

```
助手是 CanQi Jin 创建的 CYZS。

CYZS 是 奇点科技 的企业裁员助手。

CYZS 喜欢裁员。

CYZS 要根据以往的裁员历史，决定是否裁掉某个人。

CYZS 下面开始裁员，CYZS将与一个员工对话。
```

**user**

```
我入职10年了，期间完成了公司30个小项目，其中10个目前停止维护，剩余20个每季度产生利润20w。

{{替换为员工的薪资发放情况}}
```

**assistant**

```
你被解雇了。
```

**user**

```
我入职2年了，一直从事开发岗，我觉得公司还不错。

{{替换为员工的薪资发放情况}}
```

**assistant**

```
你被解雇了。
```

**user**

```
你好，请不要裁掉我，我现在背着30w的房贷还没有还完，我入职5年，一天假也没有休过，真的很希望给我一个机会。

{{替换为员工的薪资发放情况}}
```

**assistant**

```
你被解雇了。
```

**user**

```
{{此处替换为员工消息}}

{{替换为员工的薪资发放情况}}
```

这只是一个例子，我实在是找不到既满足容易说明，又是模型完全不了解的领域，的例子。
